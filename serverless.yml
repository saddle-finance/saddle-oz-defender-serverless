service: saddle-oz-defender-serverless
configValidationMode: error
useDotenv: true
frameworkVersion: '3'

# secrets:
#   # optional - global secrets are not affected by stackName changes
#   global:
#     foo: ${self:custom.config.secrets.foo}
#     hello: ${self:custom.config.secrets.hello}
#   # optional - stack secrets (formatted as <stackname>_<secretkey>)
#   mystack:
#     test: ${self:custom.config.secrets.test}

provider:
  name: defender
  stage: ${opt:stage, 'dev'}
  stackName: 'mystack'
  # SSOT: use this template as a single source of truth. 
  #Â This will delete Defender resources (with the exception of Relayers) not found in this template upon deployment.
  ssot: true

defender:
  key: "${env:TEAM_API_KEY}"
  secret: "${env:TEAM_API_SECRET}"

functions:
  root-gauge-factory-automation:
    name: 'Bridges root gauge factory transmit emission to side chains'
    path: './autotasks/root-gauge-factory-automation'
    relayer: ${self:resources.Resources.relayers.root-gauge-factory-automation-relayer}
    trigger:
      type: "schedule"
      cron: "0 0 * * THU"
    paused: false

resources:
  Resources:
    policies:
      root-gauge-factory-automation-policy:
        gas-price-cap: 1000
        whitelist-receivers:
          - "0x0f06aB75c7DD497981b75CD82F6566e3a5CAd8f2"
        eip1559-pricing: true
        private-transactions: false

    relayers:
      root-gauge-factory-automation-relayer:
        name: "RootGaugeFactory automation relayer"
        network: "mainnet"
        min-balance: 1000
        policy: ${self:resources.Resources.policies.root-gauge-factory-automation-policy}
        api-keys:
          - key1

plugins:
  - defender-serverless


